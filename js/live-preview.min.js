(function(a){window.tbLivePreview={};a(function(){a("#tb-live-preview").bind("transitionend",function(){var c=a(this);var b=a(window).height();if(parseInt(c.css("top"))+c.height()>=b){c.css("top",(b-c.height())+"px")}else{c.css("top",Math.min(0.2*b,b-c.height())+"px")}});a("#tb-live-preview .tb-live-preview-toggle-group > .tb-live-preview-toggle-group-content").bind("refresh",function(){var c=a(this);var b=c.parent(".tb-live-preview-toggle-group");c.height(b.hasClass("tb-live-preview-toggle-group-open")?c.find("> .tb-live-preview-toggle-group-content-wrapper").height():0);a("#tb-live-preview").triggerHandler("refresh")});a("#tb-live-preview .tb-live-preview-toggle-group:not(.tb-live-preview-toggle-group-force-open) > .tb-live-preview-toggle-group-title").bind("click",function(){var c=a(this).parent(".tb-live-preview-toggle-group");var b=c.find("> .tb-live-preview-toggle-group-content");c.toggleClass("tb-live-preview-toggle-group-open");document.cookie="tb-live-preview-toggle-group-"+c.index()+"="+(c.hasClass("tb-live-preview-toggle-group-open")?"1":"0")+"; path=/";b.triggerHandler("refresh")});a("#tb-live-preview .tb-live-preview-title").bind("click",function(b){a("#tb-live-preview").toggleClass("tb-live-preview-open");document.cookie="tb-live-preview="+(a("#tb-live-preview").hasClass("tb-live-preview-open")?"1":"0")+"; path=/";if(a("#tb-live-preview").hasClass("tb-live-preview-open")){a("#tb-live-preview .tb-live-preview-toggle-group:not(.tb-live-preview-toggle-group-open, .tb-live-preview-toggle-group-force-open)").each(function(){var c=a(this);if(-1<document.cookie.indexOf("tb-live-preview-toggle-group-"+c.index()+"=1")){a("#tb-live-preview").one("transitionend",function(){c.find("> .tb-live-preview-toggle-group-title").triggerHandler("click")})}})}a("#tb-live-preview").triggerHandler("refresh")});a("#tb-live-preview .tb-live-preview-control-toggle").bind("click",function(){var c=a(this);var b=c.attr("data-tb-live-preview-name");c.toggleClass("tb-live-preview-control-toggle-on");if("undefined"!==window.tbLivePreview[b]){window.tbLivePreview[b](c.hasClass("tb-live-preview-control-toggle-on"))}});a("#tb-live-preview .tb-live-preview-control-color").bind("update",function(){var c=a(this);var b=c.attr("data-tb-live-preview-name");if("undefined"!==window.tbLivePreview[b]){clearTimeout(c.data("update-timeout"));c.data("update-timeout",setTimeout(function(){window.tbLivePreview[b](c.css("background-color"))},50))}});a("#tb-live-preview .tb-live-preview-control-color-custom").bind("change",function(h,b){var g=a(this);var f=g.val().toLowerCase().replace(/[^#0-9a-f]+/,"");var c=g.parents(".tb-live-preview-toggle-group-content-element").first().find(".tb-live-preview-control-color-picker");var d=g.parents(".tb-live-preview-toggle-group-content-element").first().find(".tb-live-preview-control-color");if(null===f.match(/^#[0-9a-f]{6}$/)){f="#000000"}g.val(f);d.css("background-color",f).triggerHandler("update");if(false!==b){c.triggerHandler("update",[0,parseInt(f.substr(1,2),16)/255]);c.triggerHandler("update",[1,parseInt(f.substr(3,2),16)/255]);c.triggerHandler("update",[2,parseInt(f.substr(5,2),16)/255])}}).bind("focus",function(){var b=a(this).parents(".tb-live-preview-toggle-group-content-element").first().find(".tb-live-preview-control-color-picker");clearTimeout(b.data("timeout"));b.show()}).bind("click",function(b){b.stopPropagation()});a("#tb-live-preview .tb-live-preview-control-color-picker").bind("update",function(g,c,l){var j=a(this);var d=j.find(".tb-live-preview-control-color-picker-color");var i=j.parents(".tb-live-preview-toggle-group-content-element").first().find(".tb-live-preview-control-color-custom");var h=d.css("background-color").replace(/[^0-9,]+/g,"").split(",");c=parseInt(c);h[0]=parseInt(h[0]);h[1]=parseInt(h[1]);h[2]=parseInt(h[2]);h[c]=Math.round(l*255);var b=h[0].toString(16);var f=h[1].toString(16);var k=h[2].toString(16);d.css({color:383<=h[0]+h[1]+h[2]?"#000000":"#ffffff","background-color":"rgb("+h.join(",")+")"}).html("rgb("+h.join(",")+")");i.val("#"+(1==b.length?"0"+b:b)+(1==f.length?"0"+f:f)+(1==k.length?"0"+k:k)).triggerHandler("change",[false]);j.parent().find('[data-tb-live-preview-control-color-picker-type="'+c+'"] > span').css("left",h[c]*154/255)}).bind("click",function(b){b.stopPropagation()});a("#tb-live-preview .tb-live-preview-control-color-picker .tb-live-preview-control-color-picker-slider > span").draggable({axis:"x",containment:"parent",drag:function(d,b){var c=b.helper.parent();c.parents(".tb-live-preview-control-color-picker").first().triggerHandler("update",[c.attr("data-tb-live-preview-control-color-picker-type"),b.position.left/154])}});a("#tb-live-preview .tb-live-preview-control-color-preset").bind("click",function(){var b=a(this);var c=b.parents(".tb-live-preview-toggle-group-content-element").first().find(".tb-live-preview-control-color-custom");if(0<c.length){c.val(b.attr("title")).triggerHandler("change")}else{b.parents(".tb-live-preview-toggle-group-content-element").first().find(".tb-live-preview-control-color").css("background-color",b.attr("title")).triggerHandler("update")}});a("#tb-live-preview .tb-live-preview-control-radio").bind("click",function(){var e=a(this);var c=e.parents(".tb-live-preview-control-radio-group").first();var b=c.attr("data-tb-live-preview-name");var d=e.attr("data-tb-live-preview-value");c.find(".tb-live-preview-control-radio.tb-live-preview-control-radio-on").removeClass("tb-live-preview-control-radio-on");e.addClass("tb-live-preview-control-radio-on");if("undefined"!==window.tbLivePreview[b]){window.tbLivePreview[b](d)}});a(document).bind("click",function(){a("#tb-live-preview .tb-live-preview-control-color-picker:visible").each(function(){var b=a(this);clearTimeout(b.data("timeout"));b.data("timeout",setTimeout(function(){b.hide()},350))})});if(-1<document.cookie.indexOf("tb-live-preview=1")){a(window).load(function(){a("#tb-live-preview .tb-live-preview-title").triggerHandler("click")})}})})(jQuery);